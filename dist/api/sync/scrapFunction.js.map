{"version":3,"sources":["../../../src/api/sync/scrapFunction.js"],"names":["forEach","require","moment","map","lodash","random","findIndex","merge","sortBy","reduce","filter","isEqual","shuffle","cron","appConstants","checkIfCountIsLimited","scrapABatch","scrapFunction","db","taskList","searchEngines","keywords","urls","batchedKeywords","chain","chunk","value","currentHour","hour","cronString","console","log","schedule","currentBatch","scrap","module","exports"],"mappings":";;AAAA;;AAEA,IAAMA,UAAUC,QAAQ,gBAAR,CAAhB;;AAEA,IAAMC,SAASD,QAAQ,QAAR,CAAf;AACA,IAAME,MAAMF,QAAQ,YAAR,CAAZ;AACA,IAAMG,SAASH,QAAQ,QAAR,CAAf;AACA,IAAMI,SAASJ,QAAQ,eAAR,CAAf;AACA,IAAMK,YAAYL,QAAQ,kBAAR,CAAlB;AACA,IAAMM,QAAQN,QAAQ,cAAR,CAAd;AACA,IAAMO,SAASP,QAAQ,eAAR,CAAf;AACA,IAAMQ,SAASR,QAAQ,eAAR,CAAf;AACA,IAAMS,SAAST,QAAQ,eAAR,CAAf;AACA,IAAMU,UAAUV,QAAQ,gBAAR,CAAhB;AACA,IAAMW,UAAUX,QAAQ,gBAAR,CAAhB;AACA,IAAMY,OAAOZ,QAAQ,WAAR,CAAb;;AAEA,IAAMa,eAAeb,QAAQ,+BAAR,CAArB;AACA,IAAMc,wBAAwBd,QAAQ,wCAAR,CAA9B;AACA,IAAMe,cAAcf,QAAQ,kBAAR,CAApB;;AAEA,IAAMgB,gBAAgB,SAAhBA,aAAgB,CAACC,EAAD,EAAKC,QAAL,EAAeC,aAAf,EAA8BC,QAA9B,EAAwCC,IAAxC,EAAiD;AACrE,MAAIC,kBAAkBnB,OAAOoB,KAAP,CAAaH,QAAb,EACnBT,OADmB,GAEnBa,KAFmB,CAEb,CAFa,EAGnBC,KAHmB,EAAtB;AAIA,MAAIC,cAAc,CAAlB;AACA,OAAI,IAAIC,OAAO,CAAf,EAAkBA,QAAQ,EAA1B,EAA8BA,MAA9B,EAAsC;AACpC,QAAMC,wBAAqBD,OAAK,CAA1B,YAAN;AACAE,YAAQC,GAAR,CAAY,2BAAZ,EAAyCF,UAAzC;AACAV,aAASS,OAAK,CAAd,EAAiB,CAAjB,IAAsBf,KAAKmB,QAAL,CAAcH,UAAd,EAA0B,YAAM;AACpD,UAAMI,eAAeV,gBAAgBI,cAAY,CAA5B,CAArB;AACAG,cAAQC,GAAR,CAAY,mBAAZ,EAAiCE,YAAjC;AACAjB,kBAAYkB,KAAZ,CAAkBhB,EAAlB,EAAsBC,QAAtB,EAAgCc,YAAhC,EAA8CN,WAA9C,EAA2DL,IAA3D;AACAK,qBAAe,CAAf;AACD,KALqB,CAAtB;AAMD;AACF,CAhBD;;AAkBAQ,OAAOC,OAAP,GAAiB;AACfnB;AADe,CAAjB","file":"scrapFunction.js","sourcesContent":["// const Promise = require('bluebird');\n\nconst forEach = require('lodash/forEach');\n\nconst moment = require('moment');\nconst map = require('lodash/map');\nconst lodash = require('lodash');\nconst random = require('lodash/random');\nconst findIndex = require('lodash/findIndex');\nconst merge = require('lodash/merge');\nconst sortBy = require('lodash/sortBy');\nconst reduce = require('lodash/reduce');\nconst filter = require('lodash/filter');\nconst isEqual = require('lodash/isEqual');\nconst shuffle = require('lodash/shuffle');\nconst cron = require('node-cron');\n\nconst appConstants = require('../../helpers/appConstants.js');\nconst checkIfCountIsLimited = require('../../helpers/checkIfCountIsLimited.js');\nconst scrapABatch = require('./scrapABatch.js');\n\nconst scrapFunction = (db, taskList, searchEngines, keywords, urls) => {\n  let batchedKeywords = lodash.chain(keywords)\n    .shuffle()\n    .chunk(5)\n    .value();\n  let currentHour = 1;\n  for(var hour = 1; hour <= 20; hour++) {\n    const cronString = `0 13 ${hour-1} * * *`;\n    console.log('scheduling items for day ', cronString);\n    taskList[hour-1][0] = cron.schedule(cronString, () => {\n      const currentBatch = batchedKeywords[currentHour-1];\n      console.log('starting in scrap', currentBatch);\n      scrapABatch.scrap(db, taskList, currentBatch, currentHour, urls);\n      currentHour += 1;\n    });\n  }\n}\n\nmodule.exports = {\n  scrapFunction,\n}\n"]}